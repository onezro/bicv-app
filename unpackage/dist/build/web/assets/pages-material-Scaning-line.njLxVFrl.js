import{aq as e,o as a,d as t,aF as l,I as o,M as u,N as r,O as i,P as n,aG as s,V as d,T as p,a6 as c,ag as m,aH as v,v as h,x as f,w as b,e as _,G as y,f as g,t as $,H as I,y as C,F as x,K as k,i as w,r as S,a5 as D,ap as P,L as V,a7 as B,aw as N,_ as q,aD as E,ao as O,z as T,D as R,aE as M,C as j}from"./index-BGMMYpLj.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as F}from"./u-icon.B26jy-l1.js";import{_ as H}from"./u-cell._nNkUgnH.js";import{_ as L}from"./u-line.CTRc1Fj8.js";import{_ as K}from"./u-input.Coqpc1Jd.js";import{_ as U,a as z}from"./u-form.Q5Xs4RHm.js";import{_ as G}from"./u-popup.CZg1TFKW.js";import{_ as Q}from"./u-button.Dr9wKWVi.js";/* empty css                                                               *//* empty css                                                                      */import"./u-loading-icon.DEWftbaH.js";const Y={data:()=>({info:{cmd:"",allowEdit:!1,random:""}}),mounted(){this.$ownerInstance.$el.querySelector("input").setAttribute("inputmode","none")},methods:{onInput(e,a){a.callMethod("_input",e.detail.value)},onConfirm:(e,a)=>{e.detail.value&&a.callMethod("_onConfirm",e.detail.value),a.callMethod("focus")},onTap(e,a){a.$el.querySelector("input").setAttribute("inputmode",this.info.allowEdit?null:"none"),setTimeout((()=>{a.$el.querySelector("input").setAttribute("inputmode",null)}),10)},onClear(e,a){a.callMethod("_onClear"),this.focusHideKeyboard(a)},focusHideKeyboard(e){e.$el.querySelector("input").setAttribute("inputmode","none"),e.$el.querySelector("input").focus(),setTimeout((()=>{e.$el.querySelector("input").setAttribute("inputmode",null)}),10)},infoChange(e,a,t,l){switch(this.info=e,e.cmd){case"focus":this.focusHideKeyboard(t);break;case"showKeyboard":t.$el.querySelector("input").focus(),t.$el.querySelector("input").setAttribute("inputmode","text")}}}},W=e=>{e.$renderjs||(e.$renderjs=[]),e.$renderjs.push("input"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.input=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),e.mixins.push(Y)},X={name:"tk-input",props:{modelValue:{type:[String,Number],default:""},allowEdit:{type:Boolean,default:!1}},model:{prop:"modelValue",event:"update:modelValue"},emits:["input","update:modelValue","confirm"],data:()=>({info:{cmd:"",allowEdit:!1,random:Math.random()}}),watch:{allowEdit:{immediate:!0,handler:function(e){this.info.allowEdit=e}}},created(){},computed:{},methods:{focus(){this.info=Object.assign({},this.info,{cmd:"focus",random:Math.random()})},showKeyboard(){this.focused=!0,this.info=Object.assign({},this.info,{cmd:"showKeyboard",random:Math.random()})},hideKeyboard(){e()},onSetText(e){this.$emit("update:modelValue",e)},onReset(){this.$emit("update:modelValue",""),this.focus()},_input(e){this.$emit("update:modelValue",e),this.$emit("input",e)},_onClear(){this.$emit("update:modelValue","")},_onConfirm(e){this.$emit("confirm",e)}}};W(X);const J=A(X,[["render",function(e,u,r,i,n,s){const d=o;return a(),t(d,l({value:r.modelValue,type:"text"},e.$attrs,{onInput:e.input.onInput,onClick:e.input.onTap,onConfirm:e.input.onConfirm,info:n.info,"change:info":e.input.infoChange}),null,16,["value","onInput","onClick","onConfirm","info","change:info"])}]]);const Z=A({name:"u-collapse-item",mixins:[i,n,u({props:{title:{type:String,default:()=>r.collapseItem.title},value:{type:String,default:()=>r.collapseItem.value},label:{type:String,default:()=>r.collapseItem.label},disabled:{type:Boolean,default:()=>r.collapseItem.disabled},isLink:{type:Boolean,default:()=>r.collapseItem.isLink},clickable:{type:Boolean,default:()=>r.collapseItem.clickable},border:{type:Boolean,default:()=>r.collapseItem.border},align:{type:String,default:()=>r.collapseItem.align},name:{type:[String,Number],default:()=>r.collapseItem.name},icon:{type:String,default:()=>r.collapseItem.icon},duration:{type:Number,default:()=>r.collapseItem.duration},showRight:{type:Boolean,default:()=>r.collapseItem.showRight}}})],data:()=>({elId:s(),animationData:{},expanded:!1,showBorder:!1,animating:!1,parentData:{accordion:!1,border:!1}}),watch:{expanded(e){clearTimeout(this.timer),this.timer=null,this.timer=setTimeout((()=>{this.showBorder=e}),e?10:290)}},mounted(){this.init()},methods:{async init(){if(this.updateParentData(),!this.parent)return d();const{value:e,accordion:a,children:t=[]}=this.parent;if(a){if(p.array(e))return d();this.expanded=this.name==e}else{if(!p.array(e)&&null!==e)return d();this.expanded=(e||[]).some((e=>e==this.name))}await c(),this.setContentAnimate()},updateParentData(){this.getParentData("u-collapse")},async setContentAnimate(){const e=await this.queryRect(),a=this.expanded?e.height:0;this.animating=!0;const t=m({timingFunction:"ease-in-out"});t.height(a).step({duration:this.duration}).step(),this.animationData=t.export(),v(this.duration).then((()=>{this.animating=!1}))},clickHandler(){this.disabled&&this.animating||this.parent&&this.parent.onChange(this)},queryRect(){return new Promise((e=>{this.$uGetRect(`#${this.elId}`).then((a=>{e(a)}))}))}}},[["render",function(e,l,o,u,r,i){const n=k,s=h(f("u-icon"),F),d=h(f("u-cell"),H),p=w,c=h(f("u-line"),L);return a(),t(p,{class:"u-collapse-item"},{default:b((()=>[_(d,{title:e.$slots.title?"":e.title,value:e.value,label:e.label,icon:e.icon,isLink:e.isLink,clickable:e.clickable,border:r.parentData.border&&r.showBorder,onClick:i.clickHandler,arrowDirection:r.expanded?"up":"down",disabled:e.disabled},{title:b((()=>[y(e.$slots,"title",{},(()=>[!e.$slots.title&&e.title?(a(),t(n,{key:0},{default:b((()=>[g($(e.title),1)])),_:1})):I("",!0)]),!0)])),icon:b((()=>[y(e.$slots,"icon",{},(()=>[!e.$slots.icon&&e.icon?(a(),t(s,{key:0,size:22,name:e.icon},null,8,["name"])):I("",!0)]),!0)])),value:b((()=>[y(e.$slots,"value",{},(()=>[!e.$slots.value&&e.value?(a(),t(n,{key:0},{default:b((()=>[g($(e.value),1)])),_:1})):I("",!0)]),!0)])),"right-icon":b((()=>[e.showRight?(a(),C(x,{key:0},[e.$slots["right-icon"]?I("",!0):(a(),t(s,{key:0,size:16,name:"arrow-right"})),y(e.$slots,"right-icon",{},void 0,!0)],64)):I("",!0)])),_:3},8,["title","value","label","icon","isLink","clickable","border","onClick","arrowDirection","disabled"]),_(p,{class:"u-collapse-item__content",animation:r.animationData,ref:"animation"},{default:b((()=>[_(p,{class:"u-collapse-item__content__text content-class",id:r.elId,ref:r.elId},{default:b((()=>[y(e.$slots,"default",{},void 0,!0)])),_:3},8,["id"])])),_:3},8,["animation"]),r.parentData.border?(a(),t(c,{key:0})):I("",!0)])),_:3})}],["__scopeId","data-v-9b67e5bf"]]);const ee=A({name:"u-collapse",mixins:[i,n,u({props:{value:{type:[String,Number,Array,null],default:()=>r.collapse.value},accordion:{type:Boolean,default:()=>r.collapse.accordion},border:{type:Boolean,default:()=>r.collapse.border}}})],watch:{needInit(){this.init()},parentData(){this.children.length&&this.children.map((e=>{"function"==typeof e.updateParentData&&e.updateParentData()}))}},created(){this.children=[]},computed:{needInit(){return[this.accordion,this.value]}},emits:["open","close","change"],methods:{init(){this.children.map((e=>{e.init()}))},onChange(e){let a=[];this.children.map(((t,l)=>{this.accordion?(t.expanded=t===e&&!e.expanded,t.setContentAnimate()):t===e&&(t.expanded=!t.expanded,t.setContentAnimate()),a.push({name:t.name||l,status:t.expanded?"open":"close"})})),this.$emit("change",a),this.$emit(e.expanded?"open":"close",e.name)}}},[["render",function(e,l,o,u,r,i){const n=h(f("u-line"),L),s=w;return a(),t(s,{class:"u-collapse"},{default:b((()=>[e.border?(a(),t(n,{key:0})):I("",!0),y(e.$slots,"default",{},void 0,!0)])),_:3})}],["__scopeId","data-v-02f3ed75"]]),ae=/^MCID\d+$/,te=/^F\d+$/,le=/^R\d+$/,oe=/-CLEAR-/,ue=/^OP\d+$/,re=e=>ae.test(e)?"Mcid":te.test(e)?"Feed":le.test(e)?"Material":oe.test(e)?"CLEAR":ue.test(e)?"OPER":"none",ie=A({__name:"line",setup(l){S("");const o=S(""),u=S("");S(!0);const r=S(),i=S(),n=S(""),s=S([]),d=S(""),p=S({}),m=S(""),v=S(""),y=S({partNumber:"",manufacturer:"",reelID:"",feederID:"",quantity:"",operator:"",lotNumber:"",dateCode:"",mnfPartNo:"",usedReelBarcodeScanned:!1,trayCoordinateX:1,trayCoordinateY:1}),A=S({partNumber:[{required:!0,message:"Part Number*",trigger:["change"]}],manufacturer:[{required:!0,message:"manufacturer",trigger:["change"]}],reelID:[{required:!0,message:"reelID",trigger:["change"]}],quantity:[{type:"number",required:!0,message:"quantity",trigger:["change"]}],operator:[{required:!0,message:"operator",trigger:["change"]}]}),F=S(),H=S(!1),L=S(!1),Y=S({operatorBarcode:"",force:!1}),W=S(),X=D((()=>y.value.manufacturer&&y.value.operator&&y.value.partNumber&&y.value.reelID&&y.value.quantity)),ae=S({ip:"",mcId:""}),te=S({ip:"",mcId:""}),le=S(!1),oe=S(""),ue=S(""),ie=S(!1),ne=S(""),se=S();P(X,(e=>{e&&$e()})),V((()=>{c((()=>{me()}))})),B((()=>{W.value=setInterval((()=>{e()}),60)})),N((()=>{clearInterval(W.value)})),q((()=>{r.value=E("NIS_Machine"),i.value=E("NIS_IPFORM"),Y.value.operatorBarcode=E("OPER"),y.value.operator=E("OPER"),ae.value.ip=r.value.ip,ae.value.mcId=r.value.mcId,te.value.ip=r.value.ip,de()}));const de=()=>{O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/configurations/host-configuration`,method:"GET",header:{alias:r.value.alias}}).then((e=>{200===e.statusCode&&(n.value=e.data.nickName,pe())}))},pe=()=>{O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/low-level-warnings/device?ErrorHandlingIfUnauthorized=&mcId=${r.value.mcId}&maxItems=10&station=-1&slot=-1&subSlot=-1&showModules=-1`,method:"GET",header:{alias:r.value.alias}}).then((e=>{200===e.statusCode&&(s.value=e.data.items)}))},ce=e=>{let a=e.find((e=>"open"==e.status));void 0!==a&&(p.value=s.value.find((e=>e.location==a.name))),d.value=null==a?d.value:a.name},me=()=>{se.value.focus()},ve=()=>{let e=o.value;u.value=e,o.value="",me(),O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/barcodes/resolve`,method:"POST",header:{alias:r.value.alias},data:{barcode:u.value}}).then((a=>{let t=a.data.matches;0!==t.length?"Operator"==t[0].pattern.name?(Y.value.operatorBarcode=u.value,Ie()):"Feeder"==t[0].pattern.name?fe():"Reel"==t[0].pattern.name&&(v.value=e,H.value&&ge()):(ie.value=!0,ue.value="条码格式有误")})),"MCID"==re(u.value)&&(he(),te.value.mcId=e),"CLEAR"==re(u.value)&&(L.value=!L.value,L.value&&(ie.value=!1,ue.value="清除Feeder绑定"))},he=()=>{O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/applications/unregister`,method:"POST",header:{alias:r.value.alias},data:ae.value}).then((e=>{200!=e.statusCode&&204!=e.statusCode||O({url:`http://${i.value.ip}:5000/api/v1.0/applications/register`,method:"POST",data:te.value}).then((e=>{200===e.statusCode?M("NIS_Machine",e.data):j({url:`/pages/material/Scaning/mcid?mcId=${te.value.mcId}`})}))}))},fe=()=>{ie.value=!1,ue.value="",O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/barcodes/resolve`,method:"POST",header:{alias:r.value.alias},data:{barcode:u.value}}).then((e=>{200!=e.statusCode&&204!=e.statusCode||(0==e.data.matches.length&&(console.log("error"),ie.value=!0,ue.value="Feeder未注册"),m.value=e.data.matches[0].match,L.value?(oe.value=u.value,ye()):(""===d.value&&(p.value={...s.value[0]}),be()))}))},be=()=>{O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/reels/summary-by-feeder?feederId=${m.value}&station=${p.value.station}&slot=${p.value.slot}&subSlot=${p.value.subSlot}`,method:"GET",header:{alias:r.value.alias}}).then((e=>{let{data:a}=e;200!=e.statusCode&&204!=e.statusCode||(a.positionDataItem.isFeederKitted?_e():(H.value=!0,y.value.feederID=m.value))}))},_e=()=>{ie.value=!1,ue.value="",O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/feeders/${m.value}/verify`,method:"POST",header:{alias:r.value.alias},data:{station:p.value.station,slot:p.value.slot,subSlot:p.value.subSlot}}).then((e=>{200==e.statusCode||204==e.statusCode?pe():(ie.value=!0,ue.value="站位验证失败")}))},ye=()=>{O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/feeders/${m.value}/clear`,method:"POST",header:{alias:r.value.alias},data:{clearBarcodeWasScanned:!0}}).then((e=>{L.value=!1,ue.value="",be(),pe()}))},ge=()=>{ie.value=!1,ue.value="",O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/reels/${v.value}/information`,method:"GET",header:{alias:r.value.alias}}).then((e=>{200!=e.statusCode&&204!=e.statusCode||(e.data.found?(y.value.partNumber=e.data.partNo,y.value.manufacturer=e.data.manufacturer,y.value.reelID=e.data.reelID,y.value.quantity=e.data.remainingQuantity):(ie.value=!0,ue.value=""))}))},$e=()=>{ie.value=!1,ue.value="",O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/kitting`,method:"POST",header:{alias:r.value.alias},data:y.value}).then((e=>{console.log(e),200!=e.statusCode&&204!=e.statusCode||(F.value.resetFields(),H.value=!1,pe())}))},Ie=()=>{ie.value=!1,ue.value="";const e=/\d+/.exec(Y.value.operatorBarcode);E("OPER")==e[0]?Y.value.force=!1:Y.value.force=!0,O({url:`http://${i.value.ip}:${i.value.port}/api/v1.0/operator/log-in-out?ErrorHandlingIfUnauthorized=`,method:"POST",header:{alias:r.value.alias},data:Y.value}).then((e=>{if(200==e.statusCode||204==e.statusCode){const a=/\d+/.exec(e.data.operatorBarcode);ie.value=!1,e.data.force?(Y.value.operatorBarcode=a[0],y.value.operator=a[0],M("OPER",a[0]),ie.value=!1,ue.value=`${e.data.operatorBarcode}登录成功`):(M("OPER",""),Y.value.operatorBarcode="",y.value.operator="",ue.value=`${e.data.operatorBarcode}已注销`)}}))};return(e,l)=>{const u=h(f("tk-input"),J),r=w,i=k,p=h(f("up-collapse-item"),Z),c=h(f("up-collapse"),ee),m=h(f("up-input"),K),v=h(f("up-form-item"),U),S=h(f("up-form"),z),D=h(f("up-popup"),G),P=h(f("up-button"),Q);return a(),t(r,{class:"content1",onClick:me},{default:b((()=>[_(r,{class:"inputbox"},{default:b((()=>[_(u,{ref_key:"myInput1",ref:se,class:"un-input",allowEdit:!0,style:{border:"1px solid #000",margin:"5px"},modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),onConfirm:ve},null,8,["modelValue"])])),_:1}),_(r,{class:"coll"},{default:b((()=>[_(r,{class:"coll-title"},{default:b((()=>[g($(n.value),1)])),_:1}),_(r,{class:"list-box"},{default:b((()=>[_(r,{class:"child"},{default:b((()=>[_(c,{value:d.value,accordion:"",border:!1,onChange:ce},{default:b((()=>[(a(!0),C(x,null,T(s.value,((e,l)=>(a(),t(p,{ref_for:!0,ref:"panel",key:e.location,name:e.location,class:R({"active-panel":e.location===d.value,"inactive-panel":e.location!==d.value})},{title:b((()=>[_(r,{class:R(["title",[e.verified?"":"ng"]])},{default:b((()=>[_(i,null,{default:b((()=>[g($(e.location),1)])),_:2},1024),_(i,null,{default:b((()=>[g($(e.partNumber),1)])),_:2},1024)])),_:2},1032,["class"])])),default:b((()=>[_(r,{class:"content"},{default:b((()=>[e.verified?I("",!0):(a(),t(i,{key:0,class:"text"},{default:b((()=>[g($(e.errorMessage||"位置未验证"),1)])),_:2},1024))])),_:2},1024)])),_:2},1032,["name","class"])))),128))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),_(D,{show:H.value,mode:"bottom"},{default:b((()=>[_(r,{style:{height:"100vh",padding:"15px",display:"flex","flex-direction":"column","justify-content":"space-between"}},{default:b((()=>[_(r,{class:""},{default:b((()=>[_(r,{class:"",style:{"font-size":"18px"}},{default:b((()=>[g($(ne.value)+"供料器 即将维护",1)])),_:1}),_(r,{class:""},{default:b((()=>[_(r,{class:""},{default:b((()=>[g("未装配供料器")])),_:1}),_(r,{class:""},{default:b((()=>[g("装配供料器："+$(y.value.feederID),1)])),_:1}),_(r,{class:""},{default:b((()=>[g("位置：1.1.1")])),_:1})])),_:1}),_(r,{class:""},{default:b((()=>[_(S,{model:y.value,rules:A.value,ref_key:"kitFormRef",ref:F,errorType:"border-bottom","label-width":"100",borderBottom:"",labelPosition:"top"},{default:b((()=>[_(v,{label:y.value.partNumber?"Part Number":"",prop:"partNumber",borderBottom:"true"},{default:b((()=>[_(m,{modelValue:y.value.partNumber,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value.partNumber=e),readonly:"",placeholder:"Part Number*",border:"none"},null,8,["modelValue"])])),_:1},8,["label"]),_(v,{label:y.value.manufacturer?"Manufacturer":"",prop:"manufacturer",borderBottom:!0},{default:b((()=>[_(m,{modelValue:y.value.manufacturer,"onUpdate:modelValue":l[2]||(l[2]=e=>y.value.manufacturer=e),readonly:"",placeholder:"Manufacturer*",border:"none"},null,8,["modelValue"])])),_:1},8,["label"]),_(v,{label:y.value.reelID?"Container ID":"",prop:"reelID",borderBottom:!0},{default:b((()=>[_(m,{modelValue:y.value.reelID,"onUpdate:modelValue":l[3]||(l[3]=e=>y.value.reelID=e),readonly:"",placeholder:"Part Number*",border:"none"},null,8,["modelValue"])])),_:1},8,["label"]),_(v,{label:y.value.quantity?"Quantity":"",prop:"quantity",borderBottom:!0},{default:b((()=>[_(m,{modelValue:y.value.quantity,"onUpdate:modelValue":l[4]||(l[4]=e=>y.value.quantity=e),readonly:"",placeholder:"Quantity*",border:"none"},null,8,["modelValue"])])),_:1},8,["label"]),_(v,{label:y.value.operator?"Operator":"",prop:"operator",borderBottom:!0},{default:b((()=>[_(m,{modelValue:y.value.operator,"onUpdate:modelValue":l[5]||(l[5]=e=>y.value.operator=e),readonly:"",placeholder:"Operator*",border:"none"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),le.value?(a(),t(r,{key:0,class:"msg-title"},{default:b((()=>[_(r,{class:"msg-box"},{default:b((()=>[_(r,{class:"",style:{"margin-left":"15px"}},{default:b((()=>[g($(oe.value),1)])),_:1}),_(r,{class:"",style:{"margin-right":"10px"}},{default:b((()=>[_(P,{color:"#000",text:"关闭",size:"small",onClick:e.closeMsg,style:{width:"40px"}},null,8,["onClick"])])),_:1})])),_:1})])),_:1})):I("",!0),_(r,{class:"msg"},{default:b((()=>[_(r,{class:"tips"},{default:b((()=>[_(i,null,{default:b((()=>[g("提示信息")])),_:1}),_(r,{class:R(["tips-content",{activetips:ie.value}])},{default:b((()=>[g($(ue.value),1)])),_:1},8,["class"])])),_:1}),H.value?(a(),t(P,{key:0,type:"info",text:"取消",onClick:l[6]||(l[6]=e=>H.value=!1)})):I("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-e8eda20e"]]);export{ie as default};
