import{aa as e,n as t,r as l,a5 as a,v as o,x as s,o as n,d as r,w as u,e as i,y as c,F as d,z as f,f as p,t as m,H as v,J as _,ab as b,ac as y,ad as g,s as h,a as S,C as k,ae as w,K as C,i as x,k as F,l as I,_ as D,a6 as O,a7 as j,a8 as L}from"./index-BGMMYpLj.js";import{_ as N,a as A}from"./u-form.Q5Xs4RHm.js";import{_ as B}from"./uni-section.CCDL9Cq2.js";import{_ as T}from"./uni-icons.DYEN23k6.js";import{_ as R,a as E}from"./uni-popup.BjKvgCqz.js";import{u as P,d as U,e as z}from"./login.B4FiVUnw.js";import{m as K}from"./mes.CHEcPLOc.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-icon.B26jy-l1.js";/* empty css                                                               */import"./u-line.CTRc1Fj8.js";import"./config.C9WjKJqE.js";function G(t){return new Promise((function(l,a){if("object"==typeof window&&"document"in window){if("function"==typeof FileReader){var o=new XMLHttpRequest;return o.open("GET",t,!0),o.responseType="blob",o.onload=function(){if(200===this.status){let e=new FileReader;e.onload=function(e){l(e.target.result)},e.onerror=a,e.readAsDataURL(this.response)}},o.onerror=a,void o.send()}var s=document.createElement("canvas"),n=s.getContext("2d"),r=new Image;return r.onload=function(){s.width=r.width,s.height=r.height,n.drawImage(r,0,0),l(s.toDataURL()),s.height=s.width=0},r.onerror=a,void(r.src=t)}"object"!=typeof plus?"object"==typeof wx&&e("getFileSystemManager")?wx.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:function(e){l("data:image/png;base64,"+e.data)},fail:function(e){a(e)}}):a(new Error("not support")):plus.io.resolveLocalFileSystemURL(function(e){if(0===e.indexOf("_www")||0===e.indexOf("_doc")||0===e.indexOf("_documents")||0===e.indexOf("_downloads"))return e;if(0===e.indexOf("file://"))return e;if(0===e.indexOf("/storage/emulated/0/"))return e;if(0===e.indexOf("/")){var t=plus.io.convertAbsoluteFileSystem(e);if(t!==e)return t;e=e.substr(1)}return"_www/"+e}(t),(function(e){e.file((function(e){var t=new plus.io.FileReader;t.onload=function(e){l(e.target.result)},t.onerror=function(e){a(e)},t.readAsDataURL(e)}),(function(e){a(e)}))}),(function(e){a(e)}))}))}const H=M({__name:"otherInspect",props:["option","list"],setup(e){const D=K(),{taskData:O,tagName:j}=t(D),{option:L,list:U}=e;l(""),l(""),l("");const z=l([]);l(!1);const M=l([]),H=l("");l("");const J=l(null),V=l(null),X=l({InspectOrder:"",DetailList:[{Step:0,SubStatus:"",Remark:"",Attachment1:{Type:"",Base64String:"",Filename:""},Attachment2:{Type:"",Base64String:"",Filename:""},Attachment3:{Type:"",Base64String:"",Filename:""},Attachment4:{Type:"",Base64String:"",Filename:""}}]}),q=l(!1);l([]);const W=a((()=>O.value.filter((({Step:e})=>e==L.step)))),Q=a((()=>0==O.value.findIndex((({Step:e})=>e==L.step)))),Y=a((()=>9==W.value[0].Status||1==W.value[0].Status||2==W.value[0].Status||3==W.value[0].Status)),Z=(e,t)=>{X.value.InspectOrder=L.order,X.value.DetailList[0].Step=parseInt(L.step),X.value.DetailList[0].SubStatus=e,X.value.DetailList[0].Remark=t,M.value.forEach(((e,t)=>{X.value.DetailList[0]["Attachment"+(t+1)]=e})),console.log(X.value)},$=e=>{e?(Z(1,e),P(X.value).then((e=>{q.value=!0,te()}))):h({title:"请备注后再确认",icon:"none"})},ee=()=>{Z(9,""),P(X.value).then((e=>{q.value=!0,te(),console.log(e)}))},te=()=>{if(q.value||Y.value){let e=O.value.findIndex((({StepName:e})=>e==L.title));if(console.log(e,O.value.length),e==O.value.length-1)return h({title:"没有下一项了"}),void w({delta:1});k({url:"/pages/mes/ticketDetail/index?order="+L.order+"&step="+O.value[e+1].Step+"&type="+L.type+"&title="+O.value[e+1].StepName})}else h({title:"请先完成结果判定",icon:"none"})};return(t,l)=>{const a=C,w=o(s("up-form-item"),N),D=o(s("up-form"),A),j=x,U=o(s("uni-section"),B),K=o(s("uni-icons"),T),le=F,ae=I,oe=o(s("uni-popup-dialog"),R),se=o(s("uni-popup"),E);return n(),r(j,{class:"detail"},{default:u((()=>[i(j,{class:"content"},{default:u((()=>[i(U,{title:e.option.title,titleFontSize:"20px",type:"line"},{default:u((()=>[(n(!0),c(d,null,f(e.list,(e=>(n(),r(j,{class:"check-content",key:e.Step},{default:u((()=>[i(D,{ref_for:!0,ref:"baseForm",borderBottom:!0,modelValue:e},{default:u((()=>[i(w,{borderBottom:!0,label:"检验名称","label-width":"100"},{default:u((()=>[i(a,null,{default:u((()=>[p(m(e.SubItemName),1)])),_:2},1024)])),_:2},1024),i(w,{borderBottom:!0,label:"检验目标","label-width":"100"},{default:u((()=>[i(a,null,{default:u((()=>[p(m(e.SubItemAim),1)])),_:2},1024)])),_:2},1024),i(w,{borderBottom:!0,label:"检验方法","label-width":"100"},{default:u((()=>[i(a,null,{default:u((()=>[p(m(e.SubItemMethod),1)])),_:2},1024)])),_:2},1024),i(w,{borderBottom:!0,label:"检查标准","label-width":"100"},{default:u((()=>[i(a,{style:{"word-wrap":"break-word","word-break":"break-all"}},{default:u((()=>[p(m(e.SubItemBasic),1)])),_:2},1024)])),_:2},1024),i(w,{borderBottom:!0,label:"解决方法","label-width":"100"},{default:u((()=>[i(a,{style:{"word-wrap":"break-word","word-break":"break-all"}},{default:u((()=>[p(m(e.SubItemSolution),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue"])])),_:2},1024)))),128))])),_:1},8,["title"])])),_:1}),i(j,{class:"bottom"},{default:u((()=>[Y.value?(n(),r(j,{key:0,class:"result"},{default:u((()=>[i(j,{class:""},{default:u((()=>[p("结果： "),9==W.value[0].Status?(n(),r(a,{key:0,style:{color:"#4CAF50"}},{default:u((()=>[p("OK")])),_:1})):v("",!0),1==W.value[0].Status?(n(),r(a,{key:1,style:{color:"red"}},{default:u((()=>[p("NG")])),_:1})):v("",!0),2==W.value[0].Status?(n(),r(a,{key:2,style:{color:"#ffa726"}},{default:u((()=>[p("报修")])),_:1})):v("",!0),3==W.value[0].Status?(n(),r(a,{key:3,style:{color:"#bdbdbd"}},{default:u((()=>[p("故障")])),_:1})):v("",!0)])),_:1})])),_:1})):v("",!0),i(j,{class:"thumbnail"},{default:u((()=>[(n(!0),c(d,null,f(z.value,((e,t)=>(n(),r(j,{class:"imgtu",key:t},{default:u((()=>[i(j,{class:"del",onClick:_((e=>{return l=t,z.value=z.value.filter(((e,t)=>l!=t)),void(M.value=M.value.filter(((e,t)=>l!=t)));var l}),["stop"])},{default:u((()=>[i(K,{type:"clear",size:"40",color:"rgb(250 0 0 / 80%)"})])),_:2},1032,["onClick"]),i(le,{class:"img",src:e,mode:"",onClick:_((e=>(e=>{g({current:e,urls:z.value})})(t)),["stop"])},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1}),i(j,{class:"choose"},{default:u((()=>[Y.value?v("",!0):(n(),r(j,{key:0,class:"decision"},{default:u((()=>[i(ae,{class:"custom-style",style:{color:"#ffffff",backgroundColor:"#4CAF50",borderColor:"#4CAF50"},onClick:l[0]||(l[0]=e=>{b({count:4,sizeType:["original","compressed"],sourceType:["camera","album"],success:e=>{z.value.push(...e.tempFilePaths),e.tempFilePaths.forEach((e=>{let t=e,l=t.lastIndexOf("/"),a=t.substr(l+1);y({src:e,success:e=>{H.value=e.type}}),G(e).then((e=>{M.value.push({Type:H.value,Base64String:e,Filename:a})})).catch((e=>{console.error("转换失败==>",e)}))}))}})})},{default:u((()=>[p(" 拍照 ")])),_:1}),"EI"==e.option.type?(n(),r(ae,{key:0,class:"custom-style",style:{color:"#ffffff",backgroundColor:"#ffa726",borderColor:"#ffa726"},onClick:l[1]||(l[1]=e=>{0!=M.value.length?S({title:"提示",content:"是否报修",success:e=>{e.confirm?(Z(2,""),P(X.value).then((e=>{q.value=!0,te()}))):e.cancel&&console.log(1)}}):h({title:"缺少拍照结果",icon:"error"})})},{default:u((()=>[p(" 报修 ")])),_:1})):v("",!0),"EI"==e.option.type?(n(),r(ae,{key:1,class:"custom-style",type:"warn",style:{color:"#ffffff",backgroundColor:"#bdbdbd",borderColor:"#bdbdbd"},onClick:l[2]||(l[2]=e=>{0!=M.value.length?S({title:"提示",content:"是否故障",success:e=>{e.confirm?(Z(3,""),P(X.value).then((e=>{q.value=!0,te(),console.log(e)}))):e.cancel}}):h({title:"缺少拍照结果",icon:"error"})})},{default:u((()=>[p(" 故障 ")])),_:1})):v("",!0),i(ae,{class:"custom-style",type:"warn",onClick:l[3]||(l[3]=e=>{0!=M.value.length?J.value.open():h({title:"缺少拍照结果",icon:"error"})})},{default:u((()=>[p(" NG ")])),_:1}),i(ae,{class:"custom-style",type:"primary",onClick:l[4]||(l[4]=e=>{0!=M.value.length?V.value.open():h({title:"缺少拍照结果",icon:"error"})})},{default:u((()=>[p(" OK ")])),_:1})])),_:1}))])),_:1}),i(j,{class:"end"},{default:u((()=>[i(ae,{disabled:Q.value,class:"custom-style",onClick:l[5]||(l[5]=e=>(()=>{let e=O.value.findIndex((({StepName:e})=>e==L.title));0!=e&&k({url:"/pages/mes/ticketDetail/index?order="+L.order+"&step="+O.value[e-1].Step+"&type="+L.type+"&title="+O.value[e-1].StepName})})())},{default:u((()=>[p(" UP ")])),_:1},8,["disabled"]),i(ae,{class:"custom-style",style:{color:"#ffffff",backgroundColor:"#0094D9",borderColor:"#0094D9"},onClick:l[6]||(l[6]=e=>te())},{default:u((()=>[p(" NE ")])),_:1})])),_:1})])),_:1}),i(j,null,{default:u((()=>[i(se,{ref_key:"inputDialog",ref:J,type:"dialog"},{default:u((()=>[i(oe,{ref:"inputClose",mode:"input",title:"备注",placeholder:"请输入内容",onConfirm:$},null,512)])),_:1},512)])),_:1}),i(j,null,{default:u((()=>[i(se,{ref_key:"alertDialog",ref:V,type:"dialog"},{default:u((()=>[i(oe,{type:"error",cancelText:"否",confirmText:"是",title:"确认提示",content:"确认检查无误",onConfirm:ee,onClose:t.dialogClose},null,8,["onClose"])])),_:1},512)])),_:1}),i(j)])),_:1})}}},[["__scopeId","data-v-e4b3291e"]]),J={__name:"index",setup(e){const a=K(),{ticketNumber:o,tagName:s,interfaceData:c}=t(a),d=l("");l([]);const f=l([]),p=l({inspectOrder:"",step:0,status:"",name:"",inspectContent:""});D((e=>{p.value.inspectOrder=e.order,p.value.step=e.step,d.value=e,O((()=>{L({title:e.order+"--"+e.title})}))})),j((()=>{m()}));const m=()=>{U(c.value).then((e=>{let t=e.content;JSON.parse(t.OrderInfo);let l=JSON.parse(t.DetailList);a.SET_taskData(l),z(p.value).then((e=>{let t=e.content;f.value=t}))}))};return(e,t)=>{const l=x;return n(),r(l,{class:""},{default:u((()=>[i(H,{option:d.value,list:f.value},null,8,["option","list"])])),_:1})}}};export{J as default};
