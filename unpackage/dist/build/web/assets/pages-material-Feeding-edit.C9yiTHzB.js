import{an as e,b as t,ao as a,c as l,s as o,n as s,r,_ as u,p as n,q as i,L as d,v as c,x as m,d as p,w as f,J as _,i as v,o as h,e as g,E as b,y,z as x,F as N,aq as w,a9 as k,am as M,f as j,t as C,H as Q,K as S}from"./index-BGMMYpLj.js";import{_ as V}from"./u-input.Coqpc1Jd.js";import{_ as O,a as P}from"./u-form.Q5Xs4RHm.js";import{_ as D}from"./uni-data-select.DrmDTM-h.js";import{_ as T,a as L}from"./u-row.CNEaJGtR.js";import{_ as B}from"./u-textarea.BjzjcY23.js";import{_ as z}from"./uni-icons.DYEN23k6.js";import{_ as U}from"./uni-section.CCDL9Cq2.js";import{_ as A}from"./u-button.Dr9wKWVi.js";import{_ as F}from"./uni-card.vMYNlN2z.js";import{_ as q}from"./uni-list-item.SqYlFseI.js";import{_ as I}from"./uni-list.BH0W-wlO.js";import{_ as R,a as W}from"./uni-swipe-action.DijPpv8B.js";import{_ as $}from"./u-popup.CZg1TFKW.js";import{b as E,a as G}from"./prompt.CRqnvq7m.js";import{O as H,g as K,h as J,i as Y,j as Z}from"./index.C_bR71-q.js";import{c as X}from"./config.C9WjKJqE.js";import{u as ee}from"./user.CJRpAqDR.js";import{_ as te}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-icon.B26jy-l1.js";/* empty css                                                               */import"./u-line.CTRc1Fj8.js";import"./uni-cloud.es.BPDmVjNF.js";import"./u-loading-icon.DEWftbaH.js";/* empty css                                                                      */function ae(s){return(s=>{const r=!1===(X.headers||{}).isToken;return s.header=X.header||{},e()&&!r&&(s.header.Authorization=e()),new Promise(((e,r)=>{t({mask:!0,title:"加载中~"}),a({url:X.dipUrl+s.url,data:s.data||{},timeout:1e4,method:s.method||"GET",header:s.header}).then((t=>{l();const a=t.data.msg;1==t.data.success?e(t.data):(console.log(t),o({title:a,icon:"none",duration:2500}),r("500"))})).catch((e=>{l(),console.log(e,1)}))}))})({url:`/api/workstation/QuerySpecBystation?workStation=${s}`,method:"post"})}const le=te({__name:"edit",setup(e){const t=ee(),{name:a}=s(t),l=r({workStationDec:"",workstationName:"",MfgOrder:"",ProductName:"",ProductDesc:"",Qty:"",Container:"",userAccount:a}),X=r({MfgOrder:"",workstationName:"",SpecName:""}),te=r({MfgOrder:"",Container:"",MaterialName:"",workstationName:"",userAccount:a}),le=r([]),oe=r([]),se=r([]),re=r(!1),ue=r({}),ne=r([{text:"下料",style:{backgroundColor:"#F56C6C"}}]),ie=r({MfgOrder:"",Container:"",MaterialName:"",workstationName:"",userAccount:a}),de=r(!1),ce=r(0),me=r("");u((e=>{l.value.workStationDec=e.workStationDec,l.value.workstationName=e.workStation,X.value.workstationName=e.workStation,te.value.workstationName=e.workStation,ie.value.workstationName=e.workStation,me.value=e.line,ae(e.workStation).then((e=>{X.value.SpecName=e.content[0].SpecName,console.log(e.content[0].SpecName)}))})),n((()=>{i().select(".sect").boundingClientRect((e=>{ce.value=e.height-48+"px"})).exec()})),d((()=>{H({lineName:me.value}).then((e=>{le.value=e.content.map((e=>({...e,value:e.MfgOrderName,text:e.MfgOrderName})))}))}));const pe=()=>{de.value=!1,setTimeout((()=>{de.value=!0}),100)},fe=()=>{w()},_e=e=>{let t=le.value.find((t=>e==t.MfgOrderName));l.value.ProductName=t.ProductName,l.value.ProductDesc=t.ProductDesc,l.value.Qty=t.Qty,X.value.MfgOrder=t.MfgOrderName,ie.value.MfgOrder=t.MfgOrderName,ge(),pe()},ve=()=>{""!=l.value.MfgOrder?(K(l.value).then((e=>{E(),ge(),o({title:e.msg,icon:"none"}),pe()})).catch((()=>{G()})),l.value.Container="",pe()):o({title:"请先选择工单",icon:"error"})},he=()=>{""!=l.value.MfgOrder?k({onlyFromCamera:!0,scanType:["qrCode","barCode","datamatrix","pdf417"],success:e=>{l.value.Container=e.result,ve()}}):o({title:"请先选择工单",icon:"error"})},ge=e=>{console.log(X.value),J(X.value).then((e=>{console.log(e.content),oe.value=e.content,Ne()}))},be=()=>{Y(te.value).then((e=>{console.log(e.content),se.value=e.content}))},ye=()=>{re.value=!1},xe=()=>{},Ne=()=>{let e=oe.value.find((e=>ue.value.MaterialName==e.MaterialName));ue.value.LoadQueueQty=e.LoadQueueQty};return(e,t)=>{const a=c(m("up-input"),V),s=c(m("up-form-item"),O),r=c(m("uni-data-select"),D),u=c(m("up-col"),T),n=v,i=c(m("up-row"),L),d=c(m("up-textarea"),B),w=c(m("uni-icons"),z),k=c(m("up-form"),P),H=c(m("uni-section"),U),K=S,J=c(m("up-button"),A),Y=c(m("uni-card"),F),X=M,ee=c(m("uni-list-item"),q),ae=c(m("uni-list"),I),me=c(m("uni-swipe-action-item"),R),pe=c(m("uni-swipe-action"),W),we=c(m("up-popup"),$);return h(),p(n,{class:"content",onTouchmove:_(xe,["stop","prevent"])},{default:f((()=>[g(H,{title:"基本信息",type:"line"},{default:f((()=>[g(n,{class:"box"},{default:f((()=>[g(k,{ref:"baseForm",model:l.value,borderBottom:!0,labelWidth:"65"},{default:f((()=>[g(s,{label:"工位",class:"test"},{default:f((()=>[g(a,{style:{height:"30px"},fontSize:"13px",border:"surround",modelValue:l.value.workStationDec,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.workStationDec=e),disabled:""},null,8,["modelValue"])])),_:1}),g(s,{label:"工单",class:"test"},{default:f((()=>[g(r,{modelValue:l.value.MfgOrder,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.MfgOrder=e),localdata:le.value,onChange:_e,clear:!1,style:{height:"30px"}},null,8,["modelValue","localdata"])])),_:1}),g(i,{gutter:"20"},{default:f((()=>[g(u,{span:"7"},{default:f((()=>[g(s,{label:"产品编码",class:"test"},{default:f((()=>[g(a,{style:{height:"35px"},fontSize:"13px",border:"surround",modelValue:l.value.ProductName,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.ProductName=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),g(u,{span:"5"},{default:f((()=>[g(s,{label:"数量",class:"test"},{default:f((()=>[g(n,{style:{width:"90px"}},{default:f((()=>[g(a,{style:{height:"30px"},fontSize:"13px",border:"surround",modelValue:l.value.Qty,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.Qty=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),g(s,{label:"产品描述",class:"test"},{default:f((()=>[g(d,{height:"30px",class:"texta",modelValue:l.value.ProductDesc,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.ProductDesc=e),disabled:""},null,8,["modelValue"])])),_:1}),g(s,{label:"批次条码",class:"test"},{default:f((()=>[g(a,{style:{height:"30px"},adjustPosition:!0,fontSize:"13px",border:"surround",modelValue:l.value.Container,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.Container=e),onFocus:fe,onConfirm:ve,focus:de.value},{suffix:f((()=>[g(w,{type:"scan",color:"#bdbdbd",onClick:he,size:"20"})])),_:1},8,["modelValue","focus"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1}),g(H,{title:"物料需求清单",type:"line",class:"sect",style:{flex:"1"}},{default:f((()=>[g(X,{"scroll-y":"true",style:b({height:ce.value})},{default:f((()=>[(h(!0),y(N,null,x(oe.value,(e=>(h(),p(Y,{margin:"10px",padding:"5px",spacing:"0px",key:e.MaterialName},{default:f((()=>[g(k,{ref_for:!0,ref:"baseForm",model:e,borderBottom:!0,labelAlign:"right",labelWidth:"60"},{default:f((()=>[g(i,{gutter:"20"},{default:f((()=>[g(u,{span:"7"},{default:f((()=>[g(s,{label:"物料编码",borderBottom:!0,class:"test1"},{default:f((()=>[g(K,{class:"header1-text"},{default:f((()=>[j(C(e.MaterialName),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(u,{span:"5"},{default:f((()=>[g(s,{label:"单件用量",borderBottom:!0,class:"test1"},{default:f((()=>[g(K,{class:"header1-text"},{default:f((()=>[j(C(e.QtyRequired),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(i,{gutter:"20"},{default:f((()=>[g(u,{span:"12"},{default:f((()=>[g(s,{label:"物料描述",borderBottom:!0,class:"test1"},{default:f((()=>[g(K,{class:"header1-text"},{default:f((()=>[j(C(e.MaterialDesc),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(i,{gutter:"20"},{default:f((()=>[g(u,{span:"7"},{default:f((()=>[g(s,{label:"主料",borderBottom:!0,class:"test1"},{default:f((()=>[1===e.isMater?(h(),p(K,{key:0,class:"header1-text"},{default:f((()=>[j("是")])),_:1})):Q("",!0),0===e.isMater?(h(),p(K,{key:1,class:"header1-text"},{default:f((()=>[j("否"+C(`(${e.originalMaterialName})`),1)])),_:2},1024)):Q("",!0)])),_:2},1024)])),_:2},1024),g(u,{span:"5"},{default:f((()=>[g(s,{label:"需求数",borderBottom:!0,class:"test1"},{default:f((()=>[g(K,{class:"header1-text"},{default:f((()=>[j(C(e.TotalQtyRequired),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(i,{gutter:"20"},{default:f((()=>[g(u,{span:"6"},{default:f((()=>[g(s,{label:"上料总量",borderBottom:!0,class:"test1"},{default:f((()=>[g(K,{class:"header1-text",style:{color:"#ffcd50","font-weight":"bold"}},{default:f((()=>[j(C(e.LoadQueueQty),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),g(u,{span:"6"},{default:f((()=>[g(J,{type:"primary",text:"下料",disabled:0==e.LoadQueueQty,size:"mini",style:{width:"30px"},onClick:t=>{return a=e,ue.value=a,te.value.MfgOrder=a.MfgOrderName,te.value.MaterialName=a.MaterialName,be(),void(re.value=!0);var a}},null,8,["disabled","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["model"])])),_:2},1024)))),128))])),_:1},8,["style"]),g(we,{show:re.value,mode:"bottom",safeAreaInsetBottom:"",closeable:"",onClose:ye,onOpen:e.open},{default:f((()=>[g(n,{class:"",style:{height:"60vh"}},{default:f((()=>[g(n,{class:"title",style:{width:"90vw",position:"sticky",left:"0",top:"0"}},{default:f((()=>[g(ae,{border:!1},{default:f((()=>[g(ee,{border:!1,title:"物料编码："+ue.value.MaterialName,note:"物料描述："+ue.value.MaterialDesc,rightText:"上料总量："+ue.value.LoadQueueQty},null,8,["title","note","rightText"])])),_:1})])),_:1}),g(X,{"scroll-top":e.scrollTop,"scroll-y":"true",style:{height:"250px"}},{default:f((()=>[g(ae,null,{default:f((()=>[g(pe,null,{default:f((()=>[(h(!0),y(N,null,x(se.value,(e=>(h(),p(me,{key:e.ContainerName,"right-options":ne.value,onClick:t=>{return a=e,ie.value.Container=a.ContainerName,ie.value.MaterialName=a.MaterialName,void Z(ie.value).then((e=>{E(),ge(),be(),o({title:e.msg,icon:"success"}),Ne()})).catch((()=>{G()}));var a},disabled:0==e.Qty},{default:f((()=>[g(ee,{title:"批次条码："+e.ContainerName,note:null===e.VendorLotNumber?"批次号：   上料量："+e.LoadQueueQty:"批次号："+e.VendorLotNumber+"   上料量："+e.LoadQueueQty,rightText:"剩余量："+e.Qty},null,8,["title","note","rightText"])])),_:2},1032,["right-options","onClick","disabled"])))),128))])),_:1})])),_:1})])),_:1},8,["scroll-top"])])),_:1})])),_:1},8,["show","onOpen"])])),_:1})])),_:1})}}},[["__scopeId","data-v-c2e8dc04"]]);export{le as default};
